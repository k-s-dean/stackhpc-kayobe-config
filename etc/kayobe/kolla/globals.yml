---
{% raw %}
docker_custom_config:
  # Disable IPTables management, since it interferes with packet forwarding
  # over linux bridges. It is enabled on the seed for the registry and image
  # building.
  iptables: '{{ "overcloud" not in group_names }}'
{% endraw %}

# We are using TLS for the registry, so it does not need to be configured as
# insecure.
docker_registry_insecure: false

# Copy CA certificates from certificates/ca/ into containers.
kolla_copy_ca_into_containers: true

# CA certificate bundle used by OpenStack services.
openstack_cacert: "/etc/pki/tls/certs/ca-bundle.crt"

# Name of the OpenStack region for Keystone endpoints.
openstack_region_name: europe-nl

# Enable TLS for RabbitMQ client-server traffic.
rabbitmq_enable_tls: true

# Use a different VRRP router ID from the old production cloud, since they
# share VLANs.
keepalived_virtual_router_id: 52

# Enable Glance Ceph backend.
glance_backend_ceph: "yes"

# Enable Cinder Ceph backend.
cinder_backend_ceph: "yes"

# Enable Nova Ceph backend.
nova_backend_ceph: "yes"

# Enable Gnocchi Ceph backend.
gnocchi_backend_storage: "ceph"

# Use a tmpfs for image conversion and encryption. This should improve
# performance.
cinder_enable_conversion_tmpfs: true

cloudkitty_storage_backend: elasticsearch
cloudkitty_collector_backend: gnocchi
es_heap_size: "8g"
enable_elasticsearch_curator: "yes"
elasticsearch_curator_tag: train-centos8
elasticsearch_curator_soft_retention_period_days: 21
elasticsearch_curator_hard_retention_period_days: 42

#memcached_connection_limit: "10000"
memcached_max_memory: "1024"
ceph_gnocchi_pool_name: metrics

# Use the chrony daemon running on the host.
enable_chrony: false

# Use service project for Octavia resources. This is the default from Ussuri.
octavia_service_auth_project: service

# Octavia Amphora certificates.
octavia_certs_country: NL
octavia_certs_state: Amsterdam
octavia_certs_organization: Leafcloud
octavia_certs_organizational_unit: cloud
octavia_certs_server_ca_common_name: server-ca.octavia.leaf.cloud
octavia_certs_client_ca_common_name: client-ca.octavia.leaf.cloud
octavia_certs_client_req_common_name: client.octavia.leaf.cloud

# Octavia Amphora flavor.
octavia_amp_flavor:
  name: "amphora"
  is_public: no
  vcpus: 1
  ram: 2048
  disk: 5

# Octavia Amphora network and subnet.
octavia_amp_network:
  name: lb-mgmt-net
  provider_network_type: vlan
  provider_segmentation_id: "{{ lb_mgmt_vlan }}"
  provider_physical_network: physnet1
  external: false
  shared: false
  subnet:
    name: lb-mgmt-subnet
    cidr: "{{ lb_mgmt_cidr }}"
    allocation_pool_start: "{{ lb_mgmt_neutron_allocation_pool_start }}"
    allocation_pool_end: "{{ lb_mgmt_neutron_allocation_pool_end }}"
    no_gateway_ip: true

# Enable cluster user trusts for Magnum. This allows the Magnum autoscaler and
# autohealer to communicate with OpenStack.
# NOTE: This exposes us to https://nvd.nist.gov/vuln/detail/CVE-2016-7404
enable_cluster_user_trust: true

prometheus_ceph_mgr_exporter_endpoints:
{% for host in groups['ceph-mgr'] %}
  - {{ 'admin_oc' | net_ip(host) ~ ':9283' }}
{% endfor %}

prometheus_hardware_monitoring_exporter_endpoints:
  - 195.114.30.117:9091

# The OpenStack exporter can take longer than the default 10s to complete its
# scrape.
prometheus_openstack_exporter_timeout: "300s"
prometheus_openstack_exporter_interval: "300s"

nova_ks_user_roles:
  # Assign the key-manager:migrator role to the nova user in the service
  # project. This is required for Masakari failover operations with encrypted
  # volumes, since the nova user is used by Masakari to perform evacuation of
  # instances.
  - user: nova
    project: service
    role: key-manager:operator

# Enable Ceph RadosGW.
enable_ceph_rgw: true
# Use the ceph-ansible deployed HAProxy load balancer.
enable_ceph_rgw_loadbalancer: false
ceph_rgw_internal_fqdn: "{{ public_rgw_fqdn }}"
ceph_rgw_external_fqdn: "{{ public_rgw_fqdn }}"
ceph_rgw_port: 443
ceph_rgw_account_in_url: true

# Container image tags.
# Specifying tags allows us to control the version of each container image.
# Any containers not listed here use the default of kolla_openstack_release.
barbican_tag: "train-centos8"
ceilometer_tag: "train-centos8"
cinder_tag: "train-centos8"
cloudkitty_tag: "train-centos8"
common_tag: "train-centos8"
elasticsearch_tag: "train-centos8"
glance_tag: "train-centos8"
gnocchi_tag: "train-centos8"
grafana_tag: "train-centos8"
haproxy_tag: "train-centos8"
heat_tag: "train-centos8"
horizon_tag: "train-2021-04-09-1557"
influxdb_tag: "train-centos8"
keepalived_tag: "train-centos8"
keystone_tag: "train-centos8"
kibana_tag: "train-centos8"
magnum_tag: "train-centos8"
mariadb_tag: "train-centos8"
masakari_tag: "train-centos8"
memcached_tag: "train-centos8"
neutron_tag: "train-centos8"
nova_tag: "train-centos8"
octavia_tag: "train-centos8"
openvswitch_tag: "train-centos8"
placement_tag: "train-centos8"
prometheus_tag: "train-centos8"
rabbitmq_tag: "train-centos8"
